<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Booking</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h2 {
            color: #333;
        }
        .destination-field {
            margin-top: 10px;
        }
        .more-destinations {
            color: blue;
            cursor: pointer;
            text-decoration: underline;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input[type="text"], input[type="datetime-local"], select, textarea {
            width: 100%;
            padding: 8px;
            margin: 4px 0;
            box-sizing: border-box;
        }
        input[type="submit"] {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCwpKtTMjgka8BLItjhkOIHUsxI4q-c7N4&libraries=places"></script>
</head>
<body>
    <h2>Travel Booking Form</h2>
    <form id="travelForm">
        <label for="startDateTime">Start Date and Time:</label>
        <input type="datetime-local" id="startDateTime" name="startDateTime" required>

        <label for="endDateTime">End Date and Time:</label>
        <input type="datetime-local" id="endDateTime" name="endDateTime" required>

        <label for="startingPoint">Starting Point Description:</label>
        <input type="text" id="startingPoint" name="startingPoint" required>

        <label for="destination1">Destination 1:</label>
        <input type="text" id="destination1" name="destination1" required>

        <div id="additionalDestinations"></div>

        <span class="more-destinations" onclick="addDestination()">+ More Destination</span><br><br>

        <label for="vehicleType">Vehicle Type:</label>
        <select id="vehicleType" name="vehicleType" required>
            <option value="HatchBack">HatchBack</option>
            <option value="Sedan">Sedan</option>
            <option value="SUV">SUV</option>
            <option value="Tempo">Tempo</option>
            <option value="UrbanCruiser">UrbanCruiser</option>
            <option value="Caravan">Caravan</option>
        </select><br><br>

        <input type="button" value="Calculate Total Distance" onclick="calculateTotalDistance()">
    </form>

    <div id="result"></div>

    <script>
        let destinationCount = 1;

        function initializeAutocomplete() {
            const startingPointInput = document.getElementById('startingPoint');
            const destination1Input = document.getElementById('destination1');

            const startingPointAutocomplete = new google.maps.places.Autocomplete(startingPointInput);
            const destination1Autocomplete = new google.maps.places.Autocomplete(destination1Input);

            startingPointAutocomplete.setFields(['address_components', 'geometry', 'icon', 'name']);
            destination1Autocomplete.setFields(['address_components', 'geometry', 'icon', 'name']);
        }

        function addDestination() {
            destinationCount++;
            const newDestination = document.createElement('div');
            newDestination.classList.add('destination-field');
            newDestination.innerHTML = `<label for="destination${destinationCount}">Destination ${destinationCount}:</label>
                                        <input type="text" id="destination${destinationCount}" name="destination${destinationCount}"><br>`;
            document.getElementById('additionalDestinations').appendChild(newDestination);

            // Add Google Maps autocomplete to the new destination field
            const newDestinationInput = document.getElementById(`destination${destinationCount}`);
            const newDestinationAutocomplete = new google.maps.places.Autocomplete(newDestinationInput);
            newDestinationAutocomplete.setFields(['address_components', 'geometry', 'icon', 'name']);
        }

        google.maps.event.addDomListener(window, 'load', initializeAutocomplete);

        function calculateTotalDistance() {
            const service = new google.maps.DistanceMatrixService();
            const startingPoint = document.getElementById('startingPoint').value;
            let destinations = [];
            for (let i = 1; i <= destinationCount; i++) {
                const destinationValue = document.getElementById(`destination${i}`).value;
                if (destinationValue) {
                    destinations.push(destinationValue);
                }
            }

            if (destinations.length > 0) {
                const waypoints = [startingPoint].concat(destinations);

                let totalDistance = 0;
                let requests = [];

                for (let i = 0; i < waypoints.length - 1; i++) {
                    requests.push(
                        new Promise((resolve, reject) => {
                            service.getDistanceMatrix(
                                {
                                    origins: [waypoints[i]],
                                    destinations: [waypoints[i + 1]],
                                    travelMode: google.maps.TravelMode.DRIVING,
                                    unitSystem: google.maps.UnitSystem.METRIC,
                                },
                                (response, status) => {
                                    if (status === 'OK') {
                                        const distance = response.rows[0].elements[0].distance.value; // meters
                                        resolve(distance);
                                    } else {
                                        reject(`Error calculating distance: ${status}`);
                                    }
                                }
                            );
                        })
                    );
                }

                Promise.all(requests)
                    .then(distances => {
                        totalDistance = distances.reduce((acc, curr) => acc + curr, 0) / 1000; // Convert to kilometers
                        document.getElementById('result').innerText = `Total Distance: ${totalDistance.toFixed(2)} km`;
                    })
                    .catch(error => {
                        document.getElementById('result').innerText = error;
                    });
            } else {
                document.getElementById('result').innerText = 'Please enter at least one destination.';
            }
        }
    </script>
</body>
</html>
